# Visualize

```{r load-data, echo: false, message: false, warning: false}

library(dplyr)
library(gt)

matches_metadata <- 
  readr::read_csv("../cleaned data/matches_metadata.csv", 
                  show_col_types = FALSE) 
set_data <- 
  readr::read_csv("../cleaned data/set_data.csv", 
                  show_col_types = FALSE) 

court_coordinates <- 
  readr::read_csv("../cleaned data/court_coordinates.csv", 
                  show_col_types = FALSE) 
rally_data <- 
  readr::read_csv("../cleaned data/rally_data.csv",
                  show_col_types = FALSE)

```

```{r table-1, echo: false, message: false, warning: false}

table_1 <- set_data |> 
  left_join(matches_metadata |> 
              select(match_id, tournament, round, year, 
                     winner, loser), by = "match_id") |>
  rename(
    match_winner = winner,
    match_loser = loser
  ) |>
  mutate(
    set_loser = if_else(set_winner == match_winner, 
                        match_loser, match_winner),
    set_winner_points = if_else(set_winner == "CHOU Tien Chen",
                            chou_score, opp_score),
    set_loser_points = if_else(set_loser == "CHOU Tien Chen", 
                           chou_score, opp_score)
  ) |> 
  select(-chou_score,-opp_score) |>
  arrange(year) 

table_1 <- table_1 |>
  mutate(
    match_label = paste0(
      tournament, " / ", round, " / ", year, " / ", match_winner, "* vs ", match_loser
    ),
    set_score = paste0(set_winner_points, " - ", set_loser_points, 
                   " (", abs(set_winner_points - set_loser_points), ")"),
    set_label = paste0("Set ", set)
  )

table_1 |>
  select(
    match_label, set_label, set_winner, set_loser, set_score
  ) |>
  gt(groupname_col = "match_label") |>
  cols_label(
    set_label = "", 
    set_winner = "", 
    set_loser = "", 
    set_score = ""
  ) |>
  tab_options(
    table.background.color = "#f9f9f9",
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    heading.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.style = "none",
    row.striping.include_table_body = FALSE
  ) |>
  cols_align(
    align = "left",
    columns = c(set_label, set_winner, set_loser, set_score)
  ) |>
  tab_style(
    style = cell_text(indent = px(20)),
    locations = cells_body(columns = set_label)
  ) |>
  tab_style(
    style = list(cell_fill(color = "#E4F2D5")),
    locations = cells_body(columns = set_winner,
                           rows = set_winner == "CHOU Tien Chen")
  ) |>
  tab_style(
    style = list(cell_fill(color = "#FFCCCB")),
    locations = cells_body(columns = set_loser,
                           rows = set_loser == "CHOU Tien Chen")
  ) |>
  tab_source_note(
    md("**Notes**: An asterisk (*) next to a player's name in the header indicates the match winner. 
    
    The table displays each setâ€™s number, set winner and loser, and final score with the point difference in parentheses.
    
    Green highlights indicate sets won by CHOU Tien Chen and red highlights indicate sets lost by him.")
  )|> 
  opt_stylize(style = 6, color = 'gray')

```


```{r table-2, echo: false, message: false, warning: false}
table_2 <- matches_metadata |> 
  summarise(
    matches_played = n(),
    matches_won = sum(winner == "CHOU Tien Chen"),
    matches_summary = paste(matches_won,"/",matches_played)
  )

table_2 |>
  select(matches_summary) |>
  gt() |>
  cols_label(
    matches_summary = "Matches Won"
  ) |>
  tab_options(
    table.background.color = "#E5E4E2"
  ) |>
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_body()
  ) |> 
  opt_stylize(style = 6, color = 'gray')

```
